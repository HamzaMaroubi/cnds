<script src="/Areas/QueryComposer/js/DataMartRouting.js"></script>
<article class="panel panel-default" data-bind="css: {visible: true}">
    <div class="panel-heading">
        <h3>Selected DataMarts: <small><span class="glyphicon glyphicon-question-sign" title="Results are stratified according to the criteria in the Primary Criteria Group. If no option is selected, a single patient count will be returned." data-html="true"></span></small></h3>
    </div>
    <div class="panel-body">
        <div class="row" style="margin:3px;">
            
                <article class="Request-Footer-DataMarts" id="RequestDataMarts">
                    <div data-bind="visible:ExternalRoutes().length > 0">
                        <h3>External DataMarts <small><span class="glyphicon glyphicon-question-sign" title="External DataSources will not be removed from the Request until submission if not selected." data-html="true"></span></small></h3>
                        <div id="gExternalRoutes" style="padding: 0; overflow-y: auto; max-height: 20vh;margin-bottom:12px;" data-bind="kendoGrid: {
                            data: ExternalRoutes,
                            sortable: false,
                            filterable: false,
                            reorderable: false,
                            columnMenu: false,
                            pageable: false,
                            scrollable: false,
                            rowTemplate: 'externalRoutesRowTmpl',
                            altRowTemplate: 'externalRoutesAltRowTmpl',
                            useKOTemplates: true,
                            columns:[
                                {field: 'DataMartID', title: ' ', width:35 },
                                {field: 'Organization', title: 'Route (Network / Project / RequestType / DataSource)'},
                                {field: 'Priority', title: 'Priority', width:90 },
                                {field: 'DueDate', title: 'Due Date', width:90 }
                                ]
                        }">
                        </div>
                    </div>

                <h3>Local DataMarts</h3>
                <div id="gDataMarts" style="padding: 0; overflow-y: auto; max-height: 20vh;" data-bind="kendoGrid: {
                    data: DataMarts,
                    sortable: false,
                    filterable: false,
                    reorderable: false,
                    columnMenu: false,
                    pageable: false,
                    scrollable: false,
                    rowTemplate: 'dataMartsRowTmpl',
                    altRowTemplate: 'dataMartsAltRowTmpl',
                    useKOTemplates: true,
                    columns:[
                        {field: 'DataMartID', title: ' ', width:35 },
                        {field: 'Name', title: 'Name'},
                        {field: 'Organization', title:'Organization'},
                        {field: 'Priority', title: 'Priority', width:90 },
                        {field: 'DueDate', title: 'Due Date', width:90 }
                        ]
                }">
                </div>
                <div style="margin-top: 5px;">
                    <button role="button" id="btnDataMartsSelectAll" data-bind="click: $root.DataMartsSelectAll, clickBubble:false" class="btn btn-primary">Select All</button>
                    <button role="button" id="btnDataMartsClearAll" data-bind="click: $root.DataMartsClearAll, clickBubble:false" class="btn btn-primary">Clear All</button>
                    <button id="btnBulkEdit" data-bind="click: $root.DataMartsBulkEdit, enable: $root.SelectedDataMartIDs().length > 0, clickBubble:false" class="btn btn-primary pull-right">Bulk Edit</button>
                </div>
            </article>
        </div>
        <br />
        <div data-bind="visible: $root.IsFieldVisible('Request-Additional-Instructions')" class="Row" style="margin:3px;">
            <label for="AdditionalInstructions">Additional Instructions <em data-bind="visible: $root.IsFieldRequired('Request-Additional-Instructions')" , style="color:red;">* </em></label>
            <textarea name="DataMartsAdditionalInstructions" id="DataMarts_AdditionalInstructions" rows="3" class="form-control" maxlength="3000" style="margin-right:10px;" data-bind="attr:{required: $root.IsFieldRequired('Request-Additional-Instructions')}, value: $root.DataMartAdditionalInstructions"></textarea>
        </div>
    </div>
</article>

<script id="dataMartsRowTmpl" type="text/html">
    <tr role="row">
        <td><input type="checkbox" data-bind="value:DataMartID, checked: $root.SelectedDataMartIDs" /></td>
        <td data-bind="text: Name"></td>
        <td data-bind="text: Organization"></td>
        <td><input id="Priority" type="text" data-bind="kendoDropDownList: {value: Priority, data: Dns.Enums.PrioritiesTranslation, dataTextField: 'text', dataValueField: 'value'}"></td>
        <td><input id="DueDate" type="text" data-bind="kendoDatePicker: DueDate"></td>
    </tr>
</script>
<script id="dataMartsAltRowTmpl" type="text/html">
    <tr role="row" class="k-alt">
        <td><input type="checkbox" data-bind="value:DataMartID, checked: $root.SelectedDataMartIDs" /></td>
        <td data-bind="text: Name"></td>
        <td data-bind="text: Organization"></td>
        <td><input id="Priority" type="text" data-bind="kendoDropDownList: {value: Priority, data: Dns.Enums.PrioritiesTranslation, dataTextField: 'text', dataValueField: 'value'}"></td>
        <td><input id="DueDate" type="text" data-bind="kendoDatePicker: DueDate"></td>
    </tr>
</script>

<script id="externalRoutesRowTmpl" type="text/html">
    <tr role="row">
        <td><input type="checkbox" data-bind="value:DataMartID, checked: $root.SelectedDataMartIDs" /></td>
        <td data-bind="text: Organization"></td>
        <td><input id="Priority" type="text" data-bind="kendoDropDownList: {value: Priority, data: Dns.Enums.PrioritiesTranslation, dataTextField: 'text', dataValueField: 'value'}"></td>
        <td><input id="DueDate" type="text" data-bind="kendoDatePicker: DueDate"></td>
    </tr>
</script>
<script id="externalRoutesAltRowTmpl" type="text/html">
    <tr role="row" class="k-alt">
        <td><input type="checkbox" data-bind="value:DataMartID, checked: $root.SelectedDataMartIDs" /></td>
        <td data-bind="text: Organization"></td>
        <td><input id="Priority" type="text" data-bind="kendoDropDownList: {value: Priority, data: Dns.Enums.PrioritiesTranslation, dataTextField: 'text', dataValueField: 'value'}"></td>
        <td><input id="DueDate" type="text" data-bind="kendoDatePicker: DueDate"></td>
    </tr>
</script>